!!! HTML
%html
  %head
    %meta{:name => "generator", :content => "nanoc #{Nanoc::VERSION}"}
    %meta{:name => "viewport", :content => "width=device-width, initial-scale=0.7"}
    %meta{:charset => "utf-8"}
    %link{:rel => "dns-prefetch", :href => "//ajax.googleapis.com"}
    %link{:rel => "dns-prefetch", :href => "//fonts.googleapis.com"}
    %link{:rel => "icon", :type => "image/png", :href => "/favicon.ico"}
    %title
      -if @item[:index] == 0
        Oleg Vaskevich
      -else
        = @item[:title]
        \- Oleg Vaskevich
    -# for maintainability, don't inline these scripts or stylesheets, especially since they're used on every page and thus cached
    -# even if Google PageSpeed is suggesting to do so
    %link{:href => "http://fonts.googleapis.com/css?family=Roboto:400,700", :rel => "stylesheet", :type => "text/css"}
    %link{:href => "#{all_styles_combined_filename}", :rel => "stylesheet", :type => "text/css"}
    :css
      #email-link-compat {
        display: none;
      }
    %noscript
      :css
        .sidebar-item, span.active, #social a {
          display: inline-block;
        }
        #email {
          display: none;
        }
  %body
    #wrapper
      #sidebar
        #profile
          %img#picture{:src => "#{profile_image_url}", :width => "#{profile_image_size}", :height => "#{profile_image_size}"}
          #name Oleg Vaskevich
        -# show the other items, sorted by their index attributes
        - @items.reject{|i| i[:index].nil? || i.binary? || item[:extension] != "haml"}.sort_by{|i| i[:index]}.each do |item|
          = link_to_unless_current(item[:title], item.identifier, {:class => "nav"})
        %br
        #social
          %a{:href => "https://twitter.com/ohleg", :target => "_blank"}
            %img{:src => "/images/twitter.png", :width => "22px", :height => "22px"}
          %a{:href => "http://www.linkedin.com/profile/view?id=98400121", :target => "_blank"}
            %img{:src => "/images/linkedin.png", :width => "22px", :height => "22px"}
          %a{:href => "https://github.com/ovaskevich", :target => "_blank"}
            %img{:src => "/images/github.png", :width => "22px", :height => "22px"}
          %a#email{:href => "#"}
            %img{:src => "/images/email.png", :width => "22px", :height => "22px"}
        -# if the browser doesn't support scripts or animations, we show #email-link-compat
        %div#email-link-compat email: me@[this domain]
        %a#email-link
          %span#email-container
      #main
        = yield
      #footer
        #footer-content
          Last updated
          = @item.mtime.strftime("%A %B %d, %Y at %I:%M:%S %P, %Z")
    %script{:src => "http://ajax.googleapis.com/ajax/libs/jquery/1.10.2/jquery.min.js", :type => "text/javascript"}
    %script{:src => "#{all_scripts_combined_filename}", :type => "text/javascript"}
    :javascript
      var SHOW_OFFSET = 200;

      $(document).ready(function() {
        $('#main').jScrollPane();

        // only show these animations the first time
        if (Modernizr.cssanimations && !$.cookie("hasFaded")) {
          $.cookie("hasFaded", true, {path: '/'});
          var lastIndex = 0;
          $("a.nav, span.active").each(function(index) {
            lastIndex = index;
            var item = $(this);
            setTimeout(function() {
              item.addClass("animated bounceInLeft");
              item.css("visibility", "visible");
              item.bind("animationend webkitAnimationEnd oAnimationEnd MSAnimationEnd",
                function() {
                  item.removeClass("animated bounceInLeft");
              });
            }, index * SHOW_OFFSET);
          })
          $("#social a").each(function(index) {
            var item = $(this);
            setTimeout(function() {
              item.addClass("animated rollIn");
              item.css("visibility", "visible");
              item.bind("animationend webkitAnimationEnd oAnimationEnd MSAnimationEnd",
                function() {
                  item.removeClass();
                });
            }, (lastIndex + index) * SHOW_OFFSET)
          });
        } else {
          $(".nav, span.active, #social a").css("visibility", "visible");
        }
      });

      $("#profile").hover(
        function() {
          $("#name").addClass("animated tada");
          $("#picture").addClass("animated pulse");
        },
        function() {
          $("#name").removeClass("animated tada");
          $("#picture").removeClass("animated pulse");
        }
      );

      var bubble = $("#email-container");
      var bubbleParent = $("#email-link");
      $("#email").click(
        function() {
          if (Modernizr.cssanimations) {
            var bubbleLink = $("#email-link");
            bubbleLink.attr("href", "mailto:me@olegvaskevich.com?subject=Hi%20Oleg");
            bubble.html("me@<span>olegvaskevich.com</span>");
            bubble.addClass("bubbleUp");
            bubbleParent.css("display", "inline-block");
          } else {
            // compatibility: just show our diff
            $("#email-link-compat").fadeIn();
          }
        }
      );
      $("#email-container").bind("animationend webkitAnimationEnd oAnimationEnd MSAnimationEnd",
        function() {
          bubbleParent.css("display", "none");
          bubble.removeClass("bubbleUp");
        });

      #{(@item[:js_partials] || '').split(',').map(&:strip).map{|j| js_partial_by_name(j)}.join('\n')}
